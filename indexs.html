<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Simulatore Gestione Separata INPS 2025</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ---------- Palette & layout ---------- */
:root{
  --bg:#e0f2fe;
  --card:#0f172a;
  --accent:#38bdf8;
  --accent-hover:#0ea5e9;
}
*{box-sizing:border-box}
body{
  margin:0;padding:2rem;
  font-family:"Poppins",sans-serif;
  background:var(--bg);color:#0f172a;
  min-height:100vh;display:flex;flex-direction:column;align-items:center
}
h1{margin:0 0 2rem;font-size:2rem;font-weight:600;text-align:center}

/* ---------- Card (input) ---------- */
.calculator{
  background:var(--card);color:#f1f5f9;
  padding:2rem;border-radius:1.25rem;width:100%;max-width:560px;
  box-shadow:0 15px 25px rgba(0,0,0,.25);backdrop-filter:blur(6px)
}
.calculator label{display:block;margin-top:1.25rem;font-size:.9rem}
.calculator select,.calculator input{
  margin-top:.35rem;padding:.6rem .75rem;width:100%;
  background:#1e293b;border:1px solid #334155;border-radius:.65rem;
  color:#e2e8f0;font-size:.9rem
}
button.action{
  margin-top:2rem;width:100%;padding:.9rem 1.2rem;
  background:var(--accent);border:none;border-radius:.8rem;
  color:#fff;font-size:1.05rem;font-weight:600;cursor:pointer;transition:.2s
}
button.action:hover{background:var(--accent-hover)}
.preset-buttons{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
  gap:.5rem;margin-top:.6rem
}
.preset-buttons button{
  padding:.45rem 0;background:#334155;border:none;border-radius:.6rem;
  color:#f1f5f9;font-size:.8rem;cursor:pointer;transition:.2s
}
.preset-buttons button:hover{background:#475569}

/* ---------- Advanced toggle ---------- */
.advanced-toggle{
  margin-top:1.5rem;width:100%;background:none;
  border:1px solid var(--accent);color:var(--accent);
  padding:.6rem;border-radius:.8rem;font-size:.9rem;cursor:pointer;transition:.25s
}
.advanced-toggle:hover{background:var(--accent);color:#fff}
.advanced{margin-top:1rem;display:none;animation:fade .3s}
@keyframes fade{from{opacity:0;transform:translateY(-6px)}to{opacity:1}}

/* ---------- Tabs ---------- */
.tab-buttons{
  display:flex;margin-top:3rem;border-radius:1rem;overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,.1)
}
.tab-btn{
  flex:1;padding:.75rem 1rem;background:#334155;color:#f1f5f9;border:none;
  font-weight:600;font-size:.9rem;cursor:pointer;transition:.2s
}
.tab-btn:not(:last-child){border-right:1px solid #475569}
.tab-btn.active{background:var(--accent);color:#fff}
.tab-content{display:none}
.tab-content.active{display:block}

/* ---------- Notebook area (tables & testo) ---------- */
.notebook{
  background:#fff;border-radius:1rem;padding:2rem 1.5rem;
  box-shadow:0 8px 20px rgba(0,0,0,.15);overflow-x:auto
}
table{border-collapse:collapse;width:100%;font-size:.85rem}
th,td{border:1px solid #cbd5e1;padding:.55rem .6rem;text-align:left}
th{background:#e2e8f0;font-weight:600}
.section-header td{background:#cbd5e1;font-weight:600;text-align:center}

/* ---------- Footnote ---------- */
.note{margin-top:2rem;font-size:.85rem;text-align:center;color:#334155;max-width:900px}
@media(max-width:600px){h1{font-size:1.6rem}}
</style>
</head>
<body>
<h1>Simulatore Gestione Separata INPS 2025</h1>

<!-- INPUT CARD -->
<div class="calculator">
  <form onsubmit="return false;">

    <label>Anno di riferimento
      <select id="anno">
        <option value="2025" selected>2025</option>
        <option value="2024">2024</option>
      </select>
    </label>

    <label>Aliquota imposta sostitutiva
      <select id="aliquota_imposta">
        <option value="0.05" selected>5%</option>
        <option value="0.15">15%</option>
      </select>
    </label>

    <label>Coefficiente di redditività
      <select id="coeff">
        <option value="0.86">86%</option>
        <option value="0.78" selected>78%</option>
        <option value="0.67">67%</option>
        <option value="0.40">40%</option>
      </select>
    </label>

    <label>Reddito lordo (€)
      <input type="number" id="reddito_lordo" min="0" step="100" required>
      <div class="preset-buttons" id="presetBtnGroup"></div>
    </label>

    <button type="button" class="advanced-toggle" id="advToggle">
      Opzioni aggiuntive (acconti & contributi 2025)
    </button>

    <div class="advanced" id="advancedFields">
      <label>Contributi INPS versati nel 2025 (deducibili) (€)
        <input type="number" id="contrib_deduc_prev" min="0" step="100" value="0">
      </label>
      <label>Acconti imposta versati nel 2025 (€)
        <input type="number" id="acconti_imposta_prev" min="0" step="100" value="0">
      </label>
      <label>Acconti contributi INPS versati nel 2025 (€)
        <input type="number" id="acconti_contrib_prev" min="0" step="100" value="0">
      </label>
    </div>

    <button type="button" class="action" id="btnCalcola">Calcola</button>
  </form>
</div>

<!-- TABS -->
<div id="resultTabs" style="display:none;width:100%;max-width:1000px;">
  <div class="tab-buttons">
    <button class="tab-btn active" data-tab="tab-risultati">Risultati</button>
    <button class="tab-btn" data-tab="tab-spiegazione">Come si calcolano</button>
  </div>

  <!-- RISULTATI -->
  <div id="tab-risultati" class="tab-content notebook active">
    <h2 style="margin-top:0">Risultati dettagliati</h2>
    <table id="resultsTable">
      <thead><tr><th>Descrizione</th><th>Formula / Credito</th><th>Importo (€)</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3 style="margin-top:2rem">Scadenze pagamento (anno successivo)</h3>
    <table id="scheduleTable">
      <thead><tr><th>Data</th><th>Dettaglio</th><th>Importo (€)</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- SPIEGAZIONE -->
  <div id="tab-spiegazione" class="tab-content notebook"></div>
</div>

<p class="note">
  Dati aggiornati a maggio 2025 (Circolare INPS n.27/2025 – aliquota 26,07 %).<br>
  Gli acconti 2026 sono calcolati 50 % a giugno e 50 % a novembre. Strumento indicativo: per conferme rivolgersi al proprio consulente.
</p>

<!-- JAVASCRIPT -->
<script>
// ---------- Utility ----------
const fmt = n => n.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2});

// ---------- Preset income buttons ----------
(()=>{
  const presets=[10000,15000,20000,25000,30000,35000,40000,45000,50000,55000,60000,65000,70000,75000,80000,85000];
  const group=document.getElementById("presetBtnGroup");
  presets.forEach(v=>{
    const b=document.createElement("button");
    b.type="button"; b.textContent=(v/1000)+"k€";
    b.onclick=()=>document.getElementById("reddito_lordo").value=v;
    group.appendChild(b);
  });
})();

// ---------- Advanced toggle ----------
document.getElementById("advToggle").onclick=()=>{
  const box=document.getElementById("advancedFields");
  box.style.display = box.style.display==="block" ? "none" : "block";
};

// ---------- Tabs behaviour ----------
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const id=btn.dataset.tab;
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  });
});

// ---------- Main calculation ----------
document.getElementById("btnCalcola").addEventListener("click",calcola);

function calcola(){
  const anno=+document.getElementById("anno").value;
  const aliquota=+document.getElementById("aliquota_imposta").value;
  const coeff=+document.getElementById("coeff").value;
  const lordo=+document.getElementById("reddito_lordo").value;
  if(!lordo){alert("Inserisci il reddito lordo");return;}

  const contribDeduc=+document.getElementById("contrib_deduc_prev").value||0;
  let creditImp=+document.getElementById("acconti_imposta_prev").value||0;
  let creditCon=+document.getElementById("acconti_contrib_prev").value||0;

  const netto=lordo*coeff;
  const baseImp=Math.max(0,netto-contribDeduc);

  // Imposta
  const saldoImp=baseImp*aliquota;
  const accImpTot=baseImp*0.05;
  const [accImp1,accImp2]=[accImpTot/2,accImpTot/2];
  const coveredSaldoImp=Math.min(saldoImp,creditImp);
  creditImp-=coveredSaldoImp;
  const saldoImpPay=saldoImp-coveredSaldoImp;
  const coveredAccImp1=Math.min(accImp1,creditImp);
  creditImp-=coveredAccImp1;
  const accImp1Pay=accImp1-coveredAccImp1;
  const coveredAccImp2=Math.min(accImp2,creditImp);
  creditImp-=coveredAccImp2;
  const accImp2Pay=accImp2-coveredAccImp2;

  // Contributi
  const saldoCon=netto*0.2607;
  const accConTot=saldoCon*0.80;
  const [accCon1,accCon2]=[accConTot/2,accConTot/2];
  const coveredSaldoCon=Math.min(saldoCon,creditCon);
  creditCon-=coveredSaldoCon;
  const saldoConPay=saldoCon-coveredSaldoCon;
  const coveredAccCon1=Math.min(accCon1,creditCon);
  creditCon-=coveredAccCon1;
  const accCon1Pay=accCon1-coveredAccCon1;
  const coveredAccCon2=Math.min(accCon2,creditCon);
  creditCon-=coveredAccCon2;
  const accCon2Pay=accCon2-coveredAccCon2;

  const totalAccPay=accImp1Pay+accImp2Pay+accCon1Pay+accCon2Pay;
  const totalPay=saldoImpPay+saldoConPay+totalAccPay;

  // ----- build RISULTATI -----
  const tbody=document.querySelector("#resultsTable tbody");
  tbody.innerHTML="";
  const header=t=>tbody.insertAdjacentHTML("beforeend",`<tr class="section-header"><td colspan="3">${t}</td></tr>`);
  const row=(d,f,v)=>tbody.insertAdjacentHTML("beforeend",`<tr><td>${d}</td><td>${f}</td><td>${fmt(v)}</td></tr>`);

  header("Reddito e imponibile");
  row("Reddito lordo","",lordo);
  row("Reddito netto",`${lordo.toLocaleString("it-IT")} × ${coeff}`,netto);
  row("Contributi deducibili 2025","- "+fmt(contribDeduc),-contribDeduc);
  row("Base imponibile imposta",`${fmt(netto)} - ${fmt(contribDeduc)}`,baseImp);

  header("Imposta sostitutiva");
  row(`Saldo (30/06/${anno+1})`,`${fmt(baseImp)} × ${(aliquota*100)}%`,saldoImp);
  row("Credito sul saldo","", -coveredSaldoImp);
  row("Saldo da versare","", saldoImpPay);
  row("1° acconto 50 % (30/06)","",accImp1);
  row("Credito sul 1° acconto","", -coveredAccImp1);
  row("1° acconto da versare","", accImp1Pay);
  row("2° acconto 50 % (30/11)","",accImp2);
  row("Credito sul 2° acconto","", -coveredAccImp2);
  row("2° acconto da versare","", accImp2Pay);
  if(creditImp>0) row("Credito imposta residuo","",creditImp);

  header("Contributi INPS Gest. Separata");
  row(`Saldo (30/06/${anno+1})`,`${fmt(netto)} × 26,07%`,saldoCon);
  row("Credito sul saldo","", -coveredSaldoCon);
  row("Saldo da versare","", saldoConPay);
  row("1° acconto 50 % (30/06)","",accCon1);
  row("Credito sul 1° acconto","", -coveredAccCon1);
  row("1° acconto da versare","", accCon1Pay);
  row("2° acconto 50 % (30/11)","",accCon2);
  row("Credito sul 2° acconto","", -coveredAccCon2);
  row("2° acconto da versare","", accCon2Pay);
  if(creditCon>0) row("Credito contributi residuo","",creditCon);

  header("Totali");
  row("Totale acconti da versare","Σ",totalAccPay);
  row("Totale da versare","",totalPay);

  // Scadenze
  const sched=document.querySelector("#scheduleTable tbody");
  sched.innerHTML="";
  const next=anno+1;
  const schedRow=(d,desc,amt)=>sched.insertAdjacentHTML("beforeend",
    `<tr><td>${d}</td><td>${desc}</td><td>${fmt(amt)}</td></tr>`);
  schedRow(`30/06/${next}`,"Saldo + 1° acconti",saldoImpPay+saldoConPay+accImp1Pay+accCon1Pay);
  schedRow(`30/11/${next}`,"2° acconti",accImp2Pay+accCon2Pay);

  // ----- build SPIEGAZIONE -----
  const euro=v=>v.toLocaleString("it-IT",{style:"currency",currency:"EUR"});
  document.getElementById("tab-spiegazione").innerHTML=`
    <p>In regime forfettario paghi imposte e contributi non sul totale che incassi
       ma sul reddito lordo moltiplicato per il tuo coefficiente di redditività.</p>
    <p>Il coefficiente dipende dal codice ATECO; nel tuo caso è
       <strong>${(coeff*100).toFixed(0)} %</strong>.</p>
    <p>Nello specifico paghi l’aliquota imposta sostitutiva del
       <strong>${(aliquota*100).toFixed(0)} %</strong> e il <strong>26,07 %</strong> di contributi INPS.</p>
    ${aliquota===0.05?'<p class="text-danger"><em>L’aliquota ridotta al 5 % vale solo per i primi 5 anni: poi passa al 15 %.</em></p>':''}

    <h4 class="mt-4">Quanto paghi di imposta sostitutiva?</h4>
    <p>Reddito lordo × coefficiente = <strong>${euro(netto)}</strong></p>
    ${contribDeduc?`<p>Reddito netto dopo deduzione contributi: <strong>${euro(baseImp)}</strong></p>`:""}
    <p>Su questo applichi ${(aliquota*100)} % = <strong>${euro(saldoImp)}</strong> (saldo).</p>
    ${saldoImpPay!==saldoImp?`<p>Saldo da versare (dopo crediti): <strong>${euro(saldoImpPay)}</strong></p>`:""}

    <h4 class="mt-4">Quanto si paga di contributi?</h4>
    <p>Reddito netto × 26,07 % = <strong>${euro(saldoCon)}</strong> (saldo).</p>
    ${saldoConPay!==saldoCon?`<p>Saldo contributi da versare: <strong>${euro(saldoConPay)}</strong></p>`:""}

    <h4 class="mt-4">Acconti per il 2026</h4>
    <p>Imposta: <strong>${euro(accImp1+accImp2)}</strong><br>
       Contributi: <strong>${euro(accCon1+accCon2)}</strong><br>
       Totale acconti: <strong>${euro(totalAccPay)}</strong></p>

    <h4 class="mt-4">Totali tra saldi e acconti</h4>
    <p><strong>${euro(totalPay)}</strong></p>
  `;

  // Mostra tabs se è la prima volta
  document.getElementById("resultTabs").style.display="block";
  // Rimani su “Risultati”
  document.querySelector("[data-tab='tab-risultati']").click();
}
</script>
</body>
</html>
