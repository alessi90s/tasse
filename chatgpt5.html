<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Simulatore Forfettario – GS 2025</title>
<style>
  body{font-family:Arial, sans-serif; background:#f9fafb; margin:0; color:#111;}
  .container{max-width:700px; margin:40px auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  h1{margin-top:0;}
  label{display:block; margin-top:12px; font-weight:600;}
  input, select{width:100%; padding:10px; margin-top:4px; border:1px solid #ddd; border-radius:8px;}
  button{margin-top:20px; padding:12px 20px; background:#2563eb; color:#fff; border:none; border-radius:8px; cursor:pointer; font-size:16px;}
  button:hover{background:#1d4ed8;}
  .hidden{display:none;}
  .results{margin-top:24px; padding:20px; background:#f3f4f6; border-radius:12px;}
  table{width:100%; border-collapse:collapse; margin-top:16px;}
  th, td{border:1px solid #ddd; padding:8px; text-align:center;}
  th{background:#f3f4f6;}
</style>
</head>
<body>
<div class="container">
  <h1>Simulatore Forfettario – GS 2025</h1>

  <label>Incassato annuo (€)</label>
  <input id="incassato" type="number" placeholder="es. 30000">

  <label>Coefficiente di redditività</label>
  <select id="coeff">
    <option value="0.78">78%</option>
    <option value="0.86">86%</option>
    <option value="0.67">67%</option>
  </select>

  <label>Imposta sostitutiva</label>
  <select id="imposta">
    <option value="0.05">5% (Startup)</option>
    <option value="0.15">15% (Ordinaria)</option>
  </select>

  <details>
    <summary>Mostra opzioni avanzate</summary>
    <label>Contributi già versati (€)</label>
    <input id="deducibili" type="number" value="0">
    <label>Acconti imposta versati anno prima (€)</label>
    <input id="accImpostaVersati" type="number" value="0">
    <label>Acconti INPS versati anno prima (€)</label>
    <input id="accInpsVersati" type="number" value="0">
  </details>

  <button onclick="calcola()">CALCOLA</button>

  <div id="risultati" class="results hidden">
    <h2>Risultati</h2>
    <p><b>Reddito imponibile:</b> <span id="outImponibile"></span></p>
    <p><b>Contributi INPS:</b> <span id="outInps"></span></p>
    <p><b>Imposta sostitutiva:</b> <span id="outImposta"></span></p>
    <p><b>Saldo da pagare ora:</b> <span id="outSaldo"></span></p>
    <p><b>Acconti anno prossimo:</b> <span id="outAcconti"></span></p>
    <p><b>Totale da versare:</b> <span id="outTotale"></span></p>

    <h3>Rate di giugno (5 rate)</h3>
    <table id="tblRate">
      <thead><tr><th>Mese</th><th>Importo</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
function €(n){return new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'}).format(n||0)}

function calcola(){
  const incassato = parseFloat(document.getElementById("incassato").value)||0;
  const coeff = parseFloat(document.getElementById("coeff").value);
  const impostaRate = parseFloat(document.getElementById("imposta").value);
  const deducibili = parseFloat(document.getElementById("deducibili")?.value)||0;
  const accImpVersati = parseFloat(document.getElementById("accImpostaVersati")?.value)||0;
  const accInpsVersati = parseFloat(document.getElementById("accInpsVersati")?.value)||0;

  const ALIQUOTA_INPS = 0.2607;
  const ACCONTO_INPS_PERC = 0.80;

  const imponibileForf = incassato * coeff;
  const inps = imponibileForf * ALIQUOTA_INPS;
  const imponibileFiscale = Math.max(0, imponibileForf - deducibili);
  const imposta = imponibileFiscale * impostaRate;

  const saldoImposta = Math.max(0, imposta - accImpVersati);
  const saldoInps = Math.max(0, inps - accInpsVersati);
  const saldoTotale = saldoImposta + saldoInps;

  const accImpostaTot = imposta;
  const accInpsTot = inps * ACCONTO_INPS_PERC;
  const accontiTotali = accImpostaTot + accInpsTot;

  const totale = saldoTotale + accontiTotali;

  document.getElementById("outImponibile").textContent = €(imponibileForf);
  document.getElementById("outInps").textContent = €(inps);
  document.getElementById("outImposta").textContent = €(imposta);
  document.getElementById("outSaldo").textContent = €(saldoTotale);
  document.getElementById("outAcconti").textContent = €(accontiTotali);
  document.getElementById("outTotale").textContent = €(totale);

  // Tabella rate (saldo + primi acconti divisi in 5 mesi)
  const giugnoDaPagare = saldoTotale + (accImpostaTot*0.5) + (accInpsTot*0.5);
  const rata = giugnoDaPagare/5;
  const mesi=["Giugno","Luglio","Agosto","Settembre","Ottobre"];
  const tbody=document.querySelector("#tblRate tbody");
  tbody.innerHTML="";
  mesi.forEach(m=>tbody.innerHTML+=`<tr><td>${m}</td><td>${€(rata)}</td></tr>`);

  document.getElementById("risultati").classList.remove("hidden");
  window.scrollTo({top: document.getElementById("risultati").offsetTop, behavior:'smooth'});
}
</script>
</body>
</html>
